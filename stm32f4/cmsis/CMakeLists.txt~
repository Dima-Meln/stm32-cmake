# Now only for STM32F407VG

PROJECT(stm32f4cmsis)

CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
ENABLE_LANGUAGE(ASM)

SET()

IF(NOT STM32_StdPeriphLib_DIR)
    SET(STM32_StdPeriphLib_DIR "/home/dima/projects/git/stm32-cmake/stm32f4/libs/CMSIS/")
    MESSAGE(STATUS "No STM32_StdPeriphLib_DIR specified, using default: " ${STM32_StdPeriphLib_DIR})
ENDIF()

INCLUDE_DIRECTORIES(
    ${STM32_StdPeriphLib_DIR}/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/
    ${STM32_StdPeriphLib_DIR}/Libraries/CMSIS/CM3/CoreSupport/
    ${CMAKE_CURRENT_SOURCE_DIR}
)

SET(CMSIS_SOURCES
    ${STM32_StdPeriphLib_DIR}/Device/ST/STM32F4xx/Source/Templates/system_stm32f10x.c
    ${STM32_StdPeriphLib_DIR}/Libraries/CMSIS/Include/core_cm4.h
)

SET(STM32_STARTUP_CL ${STM32_StdPeriphLib_DIR}/Libraries/CMSIS/Device/ST/STM32F4xx/Source/Templates/gcc_ride7/startup_stm32f4xx.s)

ADD_LIBRARY(cmsis_f4 ${CMSIS_SOURCES})
SET_TARGET_PROPERTIES(cmsis_f4 PROPERTIES COMPILE_DEFINITIONS "STM32F4xx")


INSTALL(TARGETS cmsis_f4
    RUNTIME DESTINATION bin
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
)

INSTALL(FILES 
    ${STM32_StdPeriphLib_DIR}/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/system_stm32f10x.h
    ${STM32_StdPeriphLib_DIR}/Libraries/CMSIS/CM3/CoreSupport/core_cm3.h
    ${STM32_StdPeriphLib_DIR}/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/stm32f10x.h
    DESTINATION
    include
)

INSTALL(FILES 
    ${STM32_STARTUP_CL}
    ${STM32_STARTUP_HD}
    ${STM32_STARTUP_HD_VL}
    ${STM32_STARTUP_MD}
    ${STM32_STARTUP_MD_VL}
    ${STM32_STARTUP_LD}
    ${STM32_STARTUP_LD_VL}
    ${STM32_STARTUP_XL}
    ${CMAKE_CURRENT_SOURCE_DIR}/stm32_flash.ld.in
    DESTINATION
    share/cmsis/
)